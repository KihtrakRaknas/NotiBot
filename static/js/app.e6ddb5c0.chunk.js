(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{317:function(e,t,n){"use strict";n.d(t,"a",(function(){return Ve}));var r=n(11),a=n.n(r),o=n(3),i=n.n(o),l=n(14),c=n.n(l),s=n(0),u=n.n(s),f=n(116),d=n(27),m=n(7),p=n(246),h=n(497),g=n(496),b=u.a.createContext(),y=u.a.createContext(),v=u.a.createContext(),S=n(129),x=n(78),w=n(26),E=n(31),j=Object(s.createRef)();function P(e){var t;null==(t=j.current)||t.dispatch(e)}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Object(E.getStateFromPath)(e,t),r=Object(E.getActionFromState)(n);void 0!==r&&P(r)}var I=function(){return{navigationRef:j,linkTo:C}},O=n(5),T=n(22),k=n(54),B=n(2);function A(){return u.a.createElement(O.a,{style:N.container},u.a.createElement(T.a,{style:N.loadingText},"Loading"),u.a.createElement(k.a,{size:"large",color:"white"}))}var N=B.a.create({container:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"red"},loadingText:{marginBottom:20,color:"white"}}),D=n(35),R=n(55),z=n(85),L=n(28),U=n(75),W=n(33),F=n(316),M=n(183),V=n(25),q=n(89);function G(e){var t=e.navigation,n=u.a.useState(""),r=c()(n,2),a=r[0],o=r[1],l=u.a.useState(""),s=c()(l,2),f=s[0],d=s[1],p=u.a.useState(null),h=c()(p,2),g=h[0],b=h[1];u.a.useEffect((function(){if("android"==m.a.OS)return q.e(),function(){q.a()};"standalone"==w.a.appOwnership&&M.b({}).catch((function(e){var t=e.message;R.a.alert("GoogleSignIn.initAsync(): "+t)}))}),[]);var y=F.a({expoClientId:"896187396809-tn4obhk9l23t5u8uhmrspmn89iph7lr0.apps.googleusercontent.com",webClientId:"896187396809-5tbhq093deljombkbflt9c5mrfu7qvum.apps.googleusercontent.com",androidClientId:"896187396809-i55h6jach0jrja5studqj9dr2iiuhf8a.apps.googleusercontent.com",iosClientId:"896187396809-2ks3dj1dogegfsc8a9jr32s33tt4rben.apps.googleusercontent.com"}),v=c()(y,3),S=v[0],x=v[1],E=v[2];return u.a.useEffect((function(){if(console.log("response: "),console.log(x),"success"===(null==x?void 0:x.type)){var e=x.params.id_token;console.log(e);var t=W.a.auth.GoogleAuthProvider.credential(e);W.a.auth().signInWithCredential(t).catch((function(e){console.log(e),R.a.alert(e.message)}))}}),[x]),u.a.createElement(z.a,{behavior:"padding",style:J.container},u.a.createElement(U.a,{style:{flex:1,justifyContent:"center",alignItems:"center"}},u.a.createElement(T.a,{style:J.title},"Login"),g&&u.a.createElement(T.a,{style:J.errorMessage},g),u.a.createElement(O.a,{style:J.textInputBox},u.a.createElement(D.a,{placeholder:"Email",placeholderTextColor:"white",autoCapitalize:"none",style:J.textInput,onChangeText:o,value:a})),u.a.createElement(O.a,{style:J.textInputBox},u.a.createElement(D.a,{secureTextEntry:!0,placeholder:"Password",placeholderTextColor:"white",autoCapitalize:"none",style:J.textInput,onChangeText:d,value:f})),u.a.createElement(L.a,{style:[J.submitButton,{backgroundColor:"blue"}],onPress:function(){W.a.auth().signInWithEmailAndPassword(a,f).then((function(e){})).catch((function(e){e.message.includes("The user may have been deleted")&&(e.message=e.message.substring(0,e.message.indexOf("The user may have been deleted"))),R.a.alert(e.message),b(e.message)}))}},u.a.createElement(T.a,{style:{color:"white",fontSize:20}},"Sign In")),u.a.createElement(V.g,{title:"Sign In With Google",disabled:("standalone"!=w.a.appOwnership||"web"==m.a.OS)&&!S,button:!0,light:!0,style:J.submitButton,type:"google",onPress:function(){var e,t,n,r,a,o;return i.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:if("standalone"==w.a.appOwnership&&"web"!=m.a.OS){l.next=5;break}console.log("promting async"),E(),l.next=20;break;case 5:return l.prev=5,l.next=8,i.a.awrap(M.a());case 8:return l.next=10,i.a.awrap(M.c());case 10:e=l.sent,t=e.type,n=e.user,"success"===t&&(r=n.auth.idToken,console.log(r),a=W.a.auth.GoogleAuthProvider.credential(r),W.a.auth().signInWithCredential(a).catch((function(e){console.log(e),R.a.alert(e.message)}))),l.next=20;break;case 16:l.prev=16,l.t0=l.catch(5),o=l.t0.message,R.a.alert("login: Error:"+o);case 20:case"end":return l.stop()}}),null,null,[[5,16]],Promise)}}),u.a.createElement(V.b,{titleStyle:{color:"white"},title:"Don't have an account? Sign Up",disabled:("standalone"!=w.a.appOwnership||"web"!=m.a.OS)&&!S,onPress:function(){return t.navigate("SignUp",{email:a})},type:"clear"})))}q.c();var J=B.a.create({container:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"red"},textInputBox:{borderBottomColor:"white",borderBottomWidth:1,marginBottom:40,alignSelf:"stretch"},textInput:{fontSize:24,height:40,fontWeight:"200",marginBottom:0,color:"white"},title:{fontSize:50,marginBottom:30,color:"white"},submitButton:{alignItems:"center",padding:15,borderRadius:7,marginBottom:10,margin:7,alignSelf:"stretch"},errorMessage:{color:"blue",marginBottom:20}});function Y(e){var t=e.navigation,n=e.route,r=u.a.useState(n.params.email),a=c()(r,2),o=a[0],i=a[1],l=u.a.useState(null),s=c()(l,2),f=s[0],d=s[1],m=u.a.useState(null),p=c()(m,2),h=p[0],g=p[1];return u.a.createElement(z.a,{behavior:"padding",style:$.container},u.a.createElement(U.a,{style:{flex:1,justifyContent:"center",alignItems:"center"}},u.a.createElement(T.a,{style:$.title},"Sign Up"),h&&u.a.createElement(T.a,{style:{color:"blue",marginBottom:20}},h),u.a.createElement(O.a,{style:$.textInputBox},u.a.createElement(D.a,{placeholder:"Email",placeholderTextColor:"white",autoCapitalize:"none",style:$.textInput,onChangeText:i,value:o})),u.a.createElement(O.a,{style:$.textInputBox},u.a.createElement(D.a,{placeholder:"Password",placeholderTextColor:"white",autoCapitalize:"none",style:$.textInput,onChangeText:d,value:f})),u.a.createElement(L.a,{style:$.submitButton,onPress:function(){W.a.auth().createUserWithEmailAndPassword(o,f).then((function(){})).catch((function(e){g(e.message),R.a.alert(e.message)}))}},u.a.createElement(T.a,{style:{color:"white",fontSize:20}},"Create Account")),u.a.createElement(V.b,{titleStyle:{color:"white"},title:"Already have an account? Login",onPress:function(){return t.navigate("SignIn")},type:"clear"})))}var $=B.a.create({container:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"red"},textInputBox:{borderBottomColor:"white",borderBottomWidth:1,marginBottom:40,alignSelf:"stretch"},textInput:{alignSelf:"stretch",fontSize:24,height:40,fontWeight:"200",marginBottom:0,color:"white"},title:{fontSize:50,marginBottom:30,color:"white"},submitButton:{alignItems:"center",backgroundColor:"blue",alignSelf:"stretch",padding:15,borderRadius:7,marginBottom:10}}),_=n(19),H=n.n(_),K=n(76),Z=n(71),X=n(499),Q=n(498),ee=n(493),te=n(494),ne=n(500),re=n(114),ae=n.n(re);function oe(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ie(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var le=function(e){for(var t,n=0,r=oe(e);!(t=r()).done;){n+=t.value.charCodeAt(0)}n%=126;var a="#"+(n/=126).toString(16).substr(2,6);return console.log(a),[a+"00",a+"30"]},ce=n(203),se=n(151);function ue(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return fe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fe(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var de=x.b("/");function me(e){var t=e.navigation,n=u.a.useContext(b),r=n.projectsData,a=n.listenToProject,o=n.stopListeningToProject,l=u.a.useState(!0),f=c()(l,2),d=f[0],p=f[1],h=u.a.useState([]),g=c()(h,2),S=g[0],x=g[1],E=u.a.useState(null),j=c()(E,2),P=j[0],C=j[1],I=u.a.useState(!1),B=c()(I,2),A=B[0],N=B[1],R=u.a.useState(""),z=c()(R,2),L=z[0],U=z[1],F=u.a.useState(""),M=c()(F,2),q=M[0],G=M[1],J=Object(s.useContext)(y),Y=Object(s.useContext)(v),$=Object(se.a)(),_=W.a.auth().currentUser.uid,re=W.a.firestore();function oe(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(ne.a("standard",[{identifier:"deleteNotif",buttonTitle:"Delete",options:{opensAppToForeground:!1,isAuthenticationRequired:!0,isDestructive:!0}}],{previewPlaceholder:"NotiBot Notification"}));case 2:return e.next=4,i.a.awrap(ne.a("webhookbutton",[{identifier:"webhookAction",buttonTitle:"Trigger Webhook Action",options:{opensAppToForeground:!0,isAuthenticationRequired:!0,isDestructive:!1}},{identifier:"deleteNotif",buttonTitle:"Delete",options:{opensAppToForeground:!0,isAuthenticationRequired:!0,isDestructive:!0}}],{previewPlaceholder:"NotiBot Notification With Webhook Action"}));case 4:return e.next=6,i.a.awrap(ne.a("webhooktext",[{identifier:"webhookReply",buttonTitle:"Send Text to Webhook",textInput:{submitButtonTitle:"SEND",placeholder:""},options:{opensAppToForeground:!0,isAuthenticationRequired:!0,isDestructive:!1}},{identifier:"deleteNotif",buttonTitle:"Delete",options:{opensAppToForeground:!0,isAuthenticationRequired:!0,isDestructive:!0}}],{previewPlaceholder:"NotiBot Notification With Webhook Reply"}));case 6:case"end":return e.stop()}}),null,null,null,Promise)}u.a.useEffect((function(){w.a.isDevice&&"web"!==m.a.OS&&function(){var e,t,n,r,a,o;return i.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,i.a.awrap(X.a());case 2:if(e=l.sent,t=e.status,n=t,"granted"===t){l.next=11;break}return l.next=8,i.a.awrap(X.b());case 8:r=l.sent,a=r.status,n=a;case 11:if("granted"===n){l.next=14;break}return alert("Failed to get push token for push notification!"),l.abrupt("return");case 14:return l.next=16,i.a.awrap(Q.a());case 16:o=l.sent.data,console.log(o),W.a.firestore().collection("Users").doc(_).set({"Push Tokens":W.a.firestore.FieldValue.arrayUnion(o)},{merge:!0}),"android"===m.a.OS&&ee.a("default",{name:"default",importance:te.a.MAX,vibrationPattern:[0,250,250,250],lightColor:"#FF00007C"});case 20:case"end":return l.stop()}}),null,null,null,Promise)}().then(oe)}),[!0]);var ie=function(e){return r[e].Notifications&&r[e].Notifications.length>0?r[e].Notifications[r[e].Notifications.length-1].timestamp:0};u.a.useLayoutEffect((function(){var e=null==J?void 0:J.substring(de.length-1);e&&e.length>1&&"/"==e[0]||P!=S.length||Y.current.queue||(S.length>0&&(console.log("opening most recent project!"),t.navigate("Project",{title:S[0]})),t.openDrawer()),Y.current.mainStackLoaded()}),[S,P]),u.a.useEffect((function(){var e=null==J?void 0:J.substring(de.length-1);e&&e.length>1&&"/"==e[0]&&$(encodeURI(e))}),[!0]),u.a.useLayoutEffect((function(){var e=[],t=W.a.firestore().collection("Users").doc(_).onSnapshot({includeMetadataChanges:!0},(function(t){if("Server"==(t.metadata.hasPendingWrites?"Local":"Server")){var n=t.data()&&t.data().Projects?t.data().Projects:[];console.log(t.data()),console.log("Current data: "+n);for(var r,o=function(t){if(!S.includes(t)){var n=function(e){x((function(n){return-1==n.indexOf(t)?(n=[t].concat(H()(n)),console.log("adding project to array: "+t)):e||(n=n.filter((function(e){return e!=t}))),n.sort((function(e,t){return ie(t)-ie(e)})),p(!1),console.log(n),n}))};a(t,n,!0),e.push({projectName:t,subFunc:n})}},i=ue(n);!(r=i()).done;){o(r.value)}C(n.length),0==n.length&&p(!1)}}));return function(){for(var n,r=ue(e);!(n=r()).done;){var a=n.value,i=a.projectName,l=a.subFunc;o(i,l)}t()}}),[]);var fe=function(){U(""),G(""),N(!A)};return u.a.createElement(u.a.Fragment,null,u.a.createElement(V.f,{isVisible:A,onBackdropPress:fe,ModalComponent:"web"===m.a.OS?ae.a:Z.a,overlayStyle:["web"!=m.a.OS?{width:"80%",margin:"30%",maxWidth:400}:{},{backgroundColor:"red",borderRadius:10,bottom:"20%"}]},u.a.createElement(O.a,null,u.a.createElement(O.a,{style:pe.textInputBox},u.a.createElement(D.a,{placeholder:"Project Name",placeholderTextColor:"white",autoCapitalize:"none",style:pe.textInput,onChangeText:U,value:L})),""!=q&&u.a.createElement(T.a,{style:pe.errorMessage},q),u.a.createElement(V.b,{title:"Create Project",onPress:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(L.length<2)){e.next=3;break}return G("Your name must be at least 2 characters. You only have: "+L.length),e.abrupt("return",!1);case 3:if(L.match("^[A-Za-z0-9]+$")){e.next=6;break}return G("Your name must only have letters and numbers (no spaces or special characters)"),e.abrupt("return",!1);case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),null,null,null,Promise));case 2:if(!e.sent){e.next=15;break}return e.prev=4,e.next=7,i.a.awrap(re.collection("Projects").doc(L).set({Owner:W.a.firestore.FieldValue.arrayUnion(_)}));case 7:return e.next=9,i.a.awrap(re.collection("Users").doc(_).set({Projects:W.a.firestore.FieldValue.arrayUnion(L)},{merge:!0}));case 9:N(!1),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),"permission-denied"!=e.t0.code&&"already-exists"!=e.t0.code||G("Name already taken: "+L);case 15:case"end":return e.stop()}}),null,null,[[4,12]],Promise)}}))),u.a.createElement(V.c,{backgroundColor:"red",leftComponent:{icon:"plus",type:"ant-design",color:"white",onPress:fe,size:23},centerComponent:{text:"Projects",style:{color:"white",fontSize:18,fontWeight:"bold"}},rightComponent:{icon:"settings",type:"feather",color:"white",onPress:function(){return t.navigate("Settings")},size:23}}),u.a.createElement(ce.a,{colors:["#ff000000","red"],start:{x:0,y:.6},end:{x:0,y:0},style:pe.container},d&&u.a.createElement(k.a,{size:"large"}),!d&&u.a.createElement(K.a,{style:{height:"100%",width:"100%"},data:S,renderItem:function(e){var n=e.item;return console.log("item: "+n),r[n]?u.a.createElement(V.e,{style:{borderRadius:20,marginVertical:5},bottomDivider:!0,topDivider:!0,onPress:function(){t.navigate("Project",{title:n})},linearGradientProps:{colors:le(n),start:{x:1,y:0},end:{x:0,y:0}},ViewComponent:ce.a,containerStyle:{borderRadius:20}},u.a.createElement(V.a,{size:"large",rounded:!0,title:n.substring(0,2)}),u.a.createElement(V.e.Content,null,u.a.createElement(V.e.Title,{style:pe.listItemTitle},n),u.a.createElement(V.e.Subtitle,{style:pe.listItemSubtitle},r[n].Notifications&&r[n].Notifications.length>0?r[n].Notifications[r[n].Notifications.length-1].title:"No notifications yet!")),u.a.createElement(V.e.Chevron,null)):(console.warn("Trying to render a project that doesn't exist item: "+n),null)},keyExtractor:function(e){return e},ListEmptyComponent:u.a.createElement(O.a,{style:{flex:1,flexGrow:1,justifyContent:"center",alignItems:"center",padding:20}},u.a.createElement(T.a,null,"You currently have no projects"),u.a.createElement(V.b,{style:{marginTop:10},title:"Create a new project",onPress:fe}))})))}var pe=B.a.create({container:{flex:1,justifyContent:"center",alignItems:"center",paddingTop:5,paddingHorizontal:5},textInputBox:{borderBottomColor:"white",borderBottomWidth:1,marginBottom:20,alignSelf:"stretch"},textInput:{fontSize:24,height:40,fontWeight:"200",marginBottom:0,color:"white",textAlign:"center"},errorMessage:{color:"blue",marginBottom:20},listItemTitle:{fontSize:30,fontWeight:"bold"},listItemSubtitle:{}}),he=n(134);n(228);function ge(e){e.navigation;return u.a.createElement(O.a,{style:be.container},u.a.createElement(he.a,{title:"Sign Out",onPress:function(){W.a.auth().signOut().then().catch((function(e){return console.error("Sign Out Error",e)}))}}))}var be=B.a.create({container:{flex:1,justifyContent:"center",alignItems:"center"}});function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}x.b("/");function Se(e){var t,n,r=e.navigation,a=e.route,o=Object(s.useContext)(b),i=o.projectsData,l=o.listenToProject,d=o.stopListeningToProject,m=null==(t=a.params)?void 0:t.title,p=Object(s.useState)(null==i||null==(n=i[m])?void 0:n.Notifications),h=c()(p,2),g=h[0],y=h[1],v=Object(f.a)().width>=768;u.a.useEffect((function(){if(m){var e=function(e){e?y(e.Notifications):r.openDrawer()};return l(m,e,!0),function(){return d(m,e)}}}),[m]),u.a.useLayoutEffect((function(){r.setOptions(ve(ve({},m?{title:m,headerRight:function(){return u.a.createElement(V.b,{icon:{name:"ios-options-outline",type:"ionicon",size:25,color:"white"},type:"clear",onPress:function(){return r.navigate("ProjectOptions",{title:m})}})}}:{title:""}),{},{headerLeft:function(){return v?null:u.a.createElement(V.b,{icon:{name:"menu",type:"entypo",size:25,color:"white"},type:"clear",onPress:function(){return r.openDrawer()}})}}))}),[r,m]);return m?u.a.createElement(O.a,{style:xe.container},u.a.createElement(K.a,{style:{height:"100%",width:"100%"},data:g?H()(g).reverse():[],renderItem:function(e){var t=e.item,n=e.index;return u.a.createElement(V.e,{style:xe.listItem,bottomDivider:!0,topDivider:!0,onPress:function(){return r.navigate("Notification",{index:g.length-1-n,timestamp:t.timestamp,projTitle:m})}},u.a.createElement(V.e.Content,null,u.a.createElement(V.e.Title,null,t.title.substring(0,30)),u.a.createElement(V.e.Subtitle,null,function(e){return e.subtitle?e.subtitle:e.body?e.body:null}(t).substring(0,40)),u.a.createElement(V.e.Subtitle,{left:!0},new Date(t.timestamp).toLocaleString())),u.a.createElement(V.e.Chevron,null))},keyExtractor:function(e){return e.title+e.timestamp},ListEmptyComponent:u.a.createElement(O.a,{style:{flex:1,flexGrow:1,height:"100%",justifyContent:"center",alignItems:"center",padding:20}},u.a.createElement(T.a,{style:{fontSize:15,textAlign:"center"}},"The project currently has no notifications"))})):u.a.createElement(O.a,{style:xe.container},u.a.createElement(T.a,{style:{fontSize:15,textAlign:"center"}},"Select a project"))}var xe=B.a.create({container:{flex:1,justifyContent:"center",alignItems:"center"}}),we=n(49),Ee=n(318),je=(n(468),["Owner","Manager","Subscriber"]);function Pe(e){var t,n,r=e.navigation,a=e.route,o=u.a.useContext(b),l=o.projectsData,s=o.listenToProject,f=o.stopListeningToProject,d=a.params,m=d.index,p=d.timestamp,h=d.projTitle,g=d.resValue,y=u.a.useState(null==l||null==(t=l[h])||null==(n=t.Notifications)?void 0:n[m]),v=c()(y,2),S=v[0],x=v[1],w=u.a.useState(""),E=c()(w,2),j=E[0],P=E[1],C=u.a.useState(g||""),I=c()(C,2),T=I[0],k=I[1],B=function(){for(var e=W.a.auth().currentUser.uid,t=0,n=[0,1];t<n.length;t++){var r,a,o=n[t];if(null!=l&&null!=(r=l[h])&&null!=(a=r[je[o]])&&a.includes(e))return!0}return!1},N=u.a.useState(B()),R=c()(N,2),z=R[0],F=R[1],M=W.a.firestore();u.a.useLayoutEffect((function(){var e=r.dangerouslyGetState();console.log("oldState"),console.log(JSON.stringify(e));var t=e.routes,n=e.index,a=null==t?void 0:t[t.length-2];"Project"==(null==a?void 0:a.name)&&(a.params||(a.params={title:h},console.log("oldState"),console.log(JSON.stringify(e)),r.reset({index:n,routes:t})))}),[r]),u.a.useEffect((function(){var e=function(e){if(e&&e.Notifications){for(var t=e.Notifications.length;t>-1&&(!e.Notifications[t]||e.Notifications[t].timestamp>p);)t--;e.Notifications[t]&&e.Notifications[t].timestamp==p?(F(B()),x(e.Notifications[t]),r.setParams({index:t})):r.goBack()}else r.goBack()};return s(h,e,!0),function(){return f(h,e)}}),[h,p]);var q=function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(M.collection("Projects").doc(h).set({Notifications:W.a.firestore.FieldValue.arrayRemove(S)},{merge:!0}));case 2:case"end":return e.stop()}}),null,null,null,Promise)};u.a.useLayoutEffect((function(){r.setOptions({title:null==S?void 0:S.title,headerRight:function(){return z&&u.a.createElement(V.b,{disabled:!z,icon:{name:"trash-outline",type:"ionicon",size:25,color:"white"},type:"clear",titleStyle:Ce.headerButtonTitle,onPress:q})}})}),[r,z,S]);return S?u.a.createElement(Ee.a,null,u.a.createElement(we.a,null,u.a.createElement(U.a,null,u.a.createElement(O.a,{style:Ce.headerView},u.a.createElement(V.h,{h1:!0},S.title)),u.a.createElement(O.a,{style:{alignItems:"center"}},u.a.createElement(O.a,{style:Ce.subheaderView},S.subtitle&&u.a.createElement(V.h,{style:Ce.textMargin,h4:!0,left:!0},S.subtitle),S.timestamp&&u.a.createElement(V.h,{style:Ce.textMargin,right:!0},new Date(S.timestamp).toLocaleString()+"\nEpoch: "+S.timestamp))),u.a.createElement(O.a,{style:Ce.dataView},u.a.createElement(V.h,{style:Ce.textMargin},S.body),S.webhook&&u.a.createElement(V.h,{style:Ce.textMargin},"Webhook: ",S.webhook)),S.webhook&&u.a.createElement(O.a,{style:{alignItems:"center"}},S.webhookParam&&u.a.createElement(O.a,{style:Ce.textInputBox},u.a.createElement(D.a,{placeholder:"URL parameter value",autoCapitalize:"none",style:Ce.textInput,onChangeText:P,value:j})),u.a.createElement(L.a,{style:[Ce.submitButton,{backgroundColor:"green"}],onPress:function(){var e=S.webhook+j;fetch(e).then((function(e){return e.text()})).then(k).catch((function(e){return k(e.toString())}))}},u.a.createElement(V.h,{style:{color:"white",fontSize:20}},"Call ",S.webhook+j," ",T&&"Again"))),u.a.createElement(O.a,{style:Ce.dataView},!!T&&u.a.createElement(V.h,{style:Ce.textMargin},"Response: ",T))))):u.a.createElement(A,null)}var Ce=B.a.create({container:{flex:1},headerView:{alignItems:"center"},subheaderView:{flex:1,flexDirection:"row",justifyContent:"space-between"},textMargin:{margin:10},headerButtonTitle:{color:"white"},dataView:{flex:1,flexDirection:"column",justifyContent:"flex-start"},textInputBox:{borderBottomColor:"black",borderBottomWidth:1,margin:10,marginBottom:40,alignSelf:"stretch"},textInput:{fontSize:24,height:40,fontWeight:"200",marginBottom:0,color:"black"},submitButton:{alignItems:"center",padding:15,borderRadius:7,marginBottom:10,margin:7,alignSelf:"stretch"}}),Ie=n(308);function Oe(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Te(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ke=["Full Access","Can't delete project or edit team members","Can only view data, can't delete notifications"];function Be(e){var t=e.navigation,n=e.route,r=u.a.useContext(b),o=r.projectsData,l=r.listenToProject,s=r.stopListeningToProject,f=n.params.title,d=u.a.useState([]),p=c()(d,2),h=p[0],g=p[1],y=u.a.useState(je.length),v=c()(y,2),S=v[0],x=v[1],w=u.a.useState(!1),E=c()(w,2),j=E[0],P=E[1],C=u.a.useState(!1),I=c()(C,2),B=I[0],A=I[1],N=u.a.useState(""),z=c()(N,2),L=z[0],U=z[1],F=u.a.useState(""),M=c()(F,2),q=M[0],G=M[1],J=u.a.useRef({}),Y=W.a.firestore(),$=(o[f],W.a.auth().currentUser.uid);u.a.useLayoutEffect((function(){var e=function(e){if(console.log("triggered"),e){for(var n,r=[],a=function(t){if(console.log(t),e[t])for(var n,a=function(e){console.log(e),e==$&&x(je.indexOf(t)),J.current[e]?r.push({group:t,profile:J.current[e]}):fetch("https://notibot-server.herokuapp.com/getProfileInfo",{body:JSON.stringify({uid:e}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(n){J.current[e]=n,g((function(n){return[].concat(H()(n),[{group:t,profile:J.current[e]}])}))}))},o=Oe(e[t]);!(n=o()).done;){a(n.value)}},o=Oe(je);!(n=o()).done;){a(n.value)}r.length>0&&g(r),0==S&&1==e[je[0]].length?P(!1):P(!0)}else t.goBack()};return l(f,e,!0),function(){return s(f,e)}}),[]),u.a.useLayoutEffect((function(){t.setOptions({title:f+" Options"})}),[t]);var _=function(){U(""),G(""),A(!B)},K=function(e){fetch("https://notibot-server.herokuapp.com/getProfileByEmail",{body:JSON.stringify({email:e}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return console.log(e),W.a.auth().currentUser.getIdToken(!0).then((function(t){return fetch("https://notibot-server.herokuapp.com/removeUserFromProject",{body:JSON.stringify({idToken:t,project:f,uid:e.uid}),method:"POST",headers:{"Content-Type":"application/json"}})}))})).catch((function(t){return R.a.alert("An error occurred while attempting to remove "+e+" from the project")}))};return u.a.createElement(u.a.Fragment,null,u.a.createElement(V.f,{isVisible:B,onBackdropPress:_,ModalComponent:"web"===m.a.OS?ae.a:Z.a,overlayStyle:["web"!=m.a.OS?{width:"80%",margin:"30%",maxWidth:400}:{},{backgroundColor:"red",borderRadius:10,bottom:"20%"}]},u.a.createElement(O.a,null,u.a.createElement(O.a,{style:Ae.textInputBox},u.a.createElement(D.a,{placeholder:"Email",placeholderTextColor:"white",autoCapitalize:"none",style:Ae.textInput,onChangeText:U,value:L})),""!=q&&u.a.createElement(T.a,{style:Ae.errorMessage},q),u.a.createElement(V.b,{title:"Add User",onPress:function(){fetch("https://notibot-server.herokuapp.com/getProfileByEmail",{body:JSON.stringify({email:L}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return console.log(e),W.a.auth().currentUser.getIdToken(!0).then((function(t){return fetch("https://notibot-server.herokuapp.com/addUserToProject",{body:JSON.stringify({idToken:t,project:f,uid:e.uid}),method:"POST",headers:{"Content-Type":"application/json"}})}))})).then((function(){return A(!1)})).catch((function(e){return R.a.alert("An error occurred while attempting to add "+L+" to the project")}))}}))),u.a.createElement(we.a,{contentContainerStyle:Ae.container},u.a.createElement(O.a,{style:{width:"100%"}},function(){var e=[],t=function(t){var n=h[t],r=void 0;e.push(u.a.createElement(V.e,{key:n.profile.email,style:[Ae.listItem,{zIndex:-1*t}],bottomDivider:!0,topDivider:!0},u.a.createElement(V.a,{source:{uri:n.profile.photoURL},title:n.profile.email.substring(0,2),rounded:!0}),u.a.createElement(V.e.Content,null,u.a.createElement(V.e.Title,null,n.profile.displayName),u.a.createElement(V.e.Subtitle,{adjustsFontSizeToFit:!0,numberOfLines:1},n.profile.email)),u.a.createElement(Ie.a,{disabled:S>0||$==n.profile.uid&&!j,items:[].concat(H()(je),["Remove"]).map((function(e){return{label:e,value:e}})),defaultValue:n.group,containerStyle:{flexGrow:.5},itemStyle:{overflow:"visible"},controller:function(e){return r=e},onChangeItem:function(e){var t=e.value;if(console.log(t),"Remove"==t)R.a.alert("Remove "+n.profile.email,"Are you sure you want remove "+n.profile.email+" from this project?",[{text:"Remove",onPress:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:K(n.profile.email);case 1:case"end":return e.stop()}}),null,null,null,Promise)},style:"destructive"},{text:"Cancel",style:"cancel",onPress:function(){r.selectItem(n.group)}}],{cancelable:!0,onDismiss:function(){r.selectItem(n.group)}});else{var a={};je.forEach((function(e){a[e]=W.a.firestore.FieldValue.arrayRemove(n.profile.uid)})),a[t]=W.a.firestore.FieldValue.arrayUnion(n.profile.uid),Y.collection("Projects").doc(f).update(a)}}})))};for(var n in h)t(n);return 0==e.length?u.a.createElement(k.a,{size:"large",style:{padding:10}}):e}()),u.a.createElement(V.e,{style:[{zIndex:-9},Ae.listItem],bottomDivider:!0,topDivider:!0,disabled:S>0,onPress:_},u.a.createElement(V.d,{name:"plus",type:"ant-design",color:"blue"}),u.a.createElement(V.e.Content,null,u.a.createElement(V.e.Title,null,"Add User"))),function(){var e=[];for(var t in je)e.push(u.a.createElement(O.a,{key:t,style:[Ae.listItem,Ae.descContainer]},u.a.createElement(T.a,{style:[t==S?{color:"blue"}:{},Ae.groupTitle,Ae.groupText]},je[t]),u.a.createElement(T.a,{style:[Ae.groupDesc,Ae.groupText]},ke[t])));return e}(),u.a.createElement(V.b,{disabled:S>1,containerStyle:{marginTop:20},title:"Delete Notifications",buttonStyle:Ae.deleteButton,onPress:function(){R.a.alert("Delete "+f,"Are you sure you want to delete all of "+f+"'s notifications?",[{text:"Delete",onPress:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(Y.collection("Projects").doc(f).update({Notifications:W.a.firestore.FieldValue.delete()}).then((function(){return t.goBack()})).catch((function(e){return R.a.alert("An error occurred while attempting to delete the notifications")})));case 2:case"end":return e.stop()}}),null,null,null,Promise)},style:"destructive"},{text:"Cancel",style:"cancel"}],{cancelable:!0})}}),u.a.createElement(V.b,{disabled:!j,containerStyle:{marginTop:20},title:"Leave Project",buttonStyle:Ae.leaveButton,onPress:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(Y.collection("Projects").doc(f).update(a()({},je[S],W.a.firestore.FieldValue.arrayRemove($))));case 2:return e.next=4,i.a.awrap(Y.collection("Users").doc($).update({Projects:W.a.firestore.FieldValue.arrayRemove(f)}));case 4:case"end":return e.stop()}}),null,null,null,Promise)}}),!j&&u.a.createElement(T.a,{style:Ae.explanationText},"You are the only owner, you can't leave until appointing a new owner"),u.a.createElement(V.b,{disabled:S>0,containerStyle:{marginTop:20},title:"Delete Project",buttonStyle:Ae.deleteButton,onPress:function(){R.a.alert("Delete "+f,"Are you sure you want to delete "+f+"?",[{text:"Delete",onPress:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:W.a.auth().currentUser.getIdToken(!0).then((function(e){return fetch("https://notibot-server.herokuapp.com/deleteProject",{body:JSON.stringify({idToken:e,project:f}),method:"POST",headers:{"Content-Type":"application/json"}})})).catch((function(e){return R.a.alert("An error occurred while attempting to delete the project")}));case 1:case"end":return e.stop()}}),null,null,null,Promise)},style:"destructive"},{text:"Cancel",style:"cancel"}],{cancelable:!0})}})))}var Ae=B.a.create({container:{paddingBottom:20,alignItems:"center"},deleteButton:{backgroundColor:"red"},leaveButton:{backgroundColor:"blue"},listItem:{width:"100%"},descContainer:{flexGrow:1,flexDirection:"row",padding:10,zIndex:-99},groupTitle:{marginRight:10,flexBasis:100},groupText:{fontSize:15},groupDesc:{flexShrink:1,flexWrap:"wrap"},explanationText:{textAlign:"center",marginHorizontal:20},textInputBox:{borderBottomColor:"white",borderBottomWidth:1,marginBottom:20,alignSelf:"stretch"},textInput:{fontSize:24,height:40,fontWeight:"200",marginBottom:0,color:"white",textAlign:"center"}}),Ne=n(501);function De(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Re(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}try{W.a.initializeApp({apiKey:"AIzaSyBc_AtukKnVqdNYRefB-NtZLy5otD8KMvA",authDomain:"notibotapp.firebaseapp.com",databaseURL:"https://notibotapp.firebaseio.com",projectId:"notibotapp",storageBucket:"notibotapp.appspot.com"})}catch(qe){}var Ue=Object(h.a)(),We=Object(g.a)(),Fe=W.a.firestore(),Me=x.b("/");function Ve(){var e=u.a.useRef({}),t=(u.a.useRef({}),u.a.useRef({})),n=u.a.useRef({}),r=Object(s.useRef)(),a=Object(s.useRef)(),o=Object(s.useRef)({mainStackLoaded:function(){o.current.loaded=!0,o.current.queue&&o.current.queue()},loaded:!1,queue:null}),l=u.a.useState(null),h=c()(l,2),g=h[0],E=h[1],j=("web"===m.a.OS?d.a.get("window").width:Object(f.a)().width)>=768,P=I(),C=function(e){o.current.loaded?P.linkTo(e):o.current.queue=function(){return P.linkTo(e)}};u.a.useLayoutEffect((function(){return w.a.isDevice&&"web"!==m.a.OS&&(r.current=Ne.a((function(e){var t=e.request.content;Object(S.b)({message:t.title,description:t.body,type:"info",hideStatusBar:!0,onPress:function(){var e,n,r;P.linkTo("/Main/Projects/Notification?projTitle="+(null==(e=t.data)?void 0:e.project)+"&timestamp="+(null==(n=t.data)||null==(r=n.firebaseData)?void 0:r.timestamp))}})})),a.current=Ne.b((function(e){var t,n,r,a,o,l;return i.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(t=e.notification.request.content.data,"deleteNotif"!=e.actionIdentifier){i.next=3;break}return i.abrupt("return",Fe.collection("Projects").doc(null==t?void 0:t.project).set({Notifications:W.a.firestore.FieldValue.arrayRemove(null==t?void 0:t.firebaseData)},{merge:!0}));case 3:if(n="","webhookAction"!=e.actionIdentifier){i.next=8;break}n=null==t||null==(r=t.firebaseData)?void 0:r.webhook,i.next=13;break;case 8:if("webhookReply"!=e.actionIdentifier){i.next=12;break}n=(null==t||null==(a=t.firebaseData)?void 0:a.webhook)+(null==e?void 0:e.userText),i.next=13;break;case 12:return i.abrupt("return",C(encodeURI("Main/Projects/Notification?projTitle="+(null==t?void 0:t.project)+"&timestamp="+(null==t||null==(o=t.firebaseData)?void 0:o.timestamp))));case 13:l=function(e,n){var r;Object(S.b)({message:n?"Webhook call failed!":"Webhook called!",type:n?"danger":"success",hideStatusBar:!0}),C(encodeURI("Main/Projects/Notification?projTitle="+(null==t?void 0:t.project)+"&timestamp="+(null==t||null==(r=t.firebaseData)?void 0:r.timestamp)+"&resValue="+e))},fetch(n).then((function(e){return e.text()})).then(l).catch((function(e){return l(e.toString(),!0)}));case 15:case"end":return i.stop()}}),null,null,null,Promise)}))),function(){Ne.c(r.current),Ne.c(a.current)}}),[!0]);var O=u.a.useReducer((function(e,t){switch(t.type){case"SIGN_IN":return Le(Le({},e),{},{isLoading:!1,isSignedIn:t.isSignedIn});case"SIGN_OUT":return Le(Le({},e),{},{isLoading:!1,isSignedIn:!1})}}),{isLoading:!0,isSignedIn:!1}),T=c()(O,2),k=T[0],B=T[1];u.a.useLayoutEffect((function(){x.c().then((function(e){E(e)}))}),[!0]),u.a.useLayoutEffect((function(){W.a.auth().onAuthStateChanged((function(e){console.log("Auth: "+!!e),B({type:"SIGN_IN",isSignedIn:!!e})}))}),[]);var N={projectsData:e.current,listenToProject:function(r,a,o){t.current[r]?(console.log("listener already exists for "+r),t.current[r].push(a),o&&r in e.current&&a(e.current[r])):(console.log("creating listener for "+r),t.current[r]=[a],n.current[r]=Fe.collection("Projects").doc(r).onSnapshot({includeMetadataChanges:!0},(function(n){if("Server"==(n.metadata.hasPendingWrites?"Local":"Server")){e.current[r]=n.data();for(var a,o=De(t.current[r]);!(a=o()).done;){(0,a.value)(n.data())}}}),(function(n){e.current[r]=null;for(var a,o=De(t.current[r]);!(a=o()).done;){(0,a.value)(null)}})))},stopListeningToProject:function(e,r){t.current[e]||console.warn("Listener doesn't exist. How did this happen?");var a=t.current[e].indexOf(r);console.log("Index of callback in array: "+a),t.current[e].splice(a,1),0==t.current[e].length&&(t.current[e]=null,n.current[e]())}},D=function(){return u.a.createElement(Ue.Navigator,{screenOptions:{headerStyle:{backgroundColor:"red"},headerTintColor:"#fff",headerTitleStyle:{fontWeight:"bold"}}},u.a.createElement(Ue.Screen,{name:"Project",component:Se}),u.a.createElement(Ue.Screen,{name:"ProjectOptions",component:Be}),u.a.createElement(Ue.Screen,{name:"Notification",component:Pe}))};return u.a.createElement(p.a,{ref:P.navigationRef,linking:{prefixes:[Me,"http://localhost:19006","https://notibot.kihtrak.com"],screens:{ProjectsDrawerScreen:{path:"",screens:{Projects:{path:"",screens:{Project:"project/:title",Notification:"notification/:projTitle/:timestamp/:resValue?/:index?"}}}}},subscribe:function(e){var t=function(t){var n=t.url;e(n),console.log("setInitialDeepLink("+n+")"),n!=g&&E(n)};return x.a("url",t),function(){x.d("url",t)}}}},u.a.createElement(v.Provider,{value:o},u.a.createElement(y.Provider,{value:g},u.a.createElement(b.Provider,{value:N},u.a.createElement(Ue.Navigator,{screenOptions:{headerStyle:{backgroundColor:"red"},headerTintColor:"#fff",headerTitleStyle:{fontWeight:"bold"}}},k.isLoading?u.a.createElement(Ue.Screen,{name:"Splash",component:A,options:{headerShown:!1}}):0==k.isSignedIn?u.a.createElement(u.a.Fragment,null,u.a.createElement(Ue.Screen,{name:"SignIn",component:G,options:{headerShown:!1,animationTypeForReplace:k.isSignedIn?"push":"pop"}}),u.a.createElement(Ue.Screen,{name:"SignUp",component:Y,options:{headerShown:!1,animationTypeForReplace:k.isSignedIn?"push":"pop"}})):u.a.createElement(u.a.Fragment,null,u.a.createElement(Ue.Screen,{name:"Main",component:function(){return u.a.createElement(We.Navigator,{drawerType:j?"permanent":"back",drawerStyle:j?null:{width:"100%"},overlayColor:"transparent",drawerContent:function(e){return u.a.createElement(me,e)},screenOptions:{gestureEnabled:!0}},u.a.createElement(We.Screen,{name:"Projects",component:D}))},options:{headerShown:!1}}),u.a.createElement(Ue.Screen,{name:"Settings",component:ge})))))),u.a.createElement(S.a,{position:"top"}))}},326:function(e,t,n){e.exports=n(469)}},[[326,1,2]]]);
//# sourceMappingURL=app.e6ddb5c0.chunk.js.map