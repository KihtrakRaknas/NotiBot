(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{396:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Ke}));var r=n(7),o=n.n(r),i=n(4),a=n.n(i),l=n(15),c=n.n(l),s=n(0),u=n.n(s),d=n(147),f=n(31),h=n(9),p=n(310),b=n(582),g=n(584),j=u.a.createContext(),m=u.a.createContext(),y=u.a.createContext(),x=n(162),v=n(87),O=n(29),S=n(38),w=Object(s.createRef)();function P(e){var t;null==(t=w.current)||t.dispatch(e)}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Object(S.getStateFromPath)(e,t),r=Object(S.getActionFromState)(n);void 0!==r&&P(r)}var C=function(){return{navigationRef:w,linkTo:I}},k=n(127),T=n(6),A=n(24),B=n(65),L=n(3),N=n(2);function D(){return Object(N.jsxs)(T.default,{style:R.container,children:[Object(N.jsx)(A.default,{style:R.loadingText,children:"Loading"}),Object(N.jsx)(B.default,{size:"large",color:"white"})]})}var R=L.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"red"},loadingText:{marginBottom:20,color:"white"}}),E=n(44),F=n(71),U=n(110),z=n(35),W=n(92),V=n(37),M=n(395),q=n(230),G=n(30),J=n(94);function K(e){var t=e.navigation,n=u.a.useState(""),r=c()(n,2),o=r[0],i=r[1],l=u.a.useState(""),s=c()(l,2),d=s[0],f=s[1],p=u.a.useState(null),b=c()(p,2),g=b[0],j=b[1];u.a.useEffect((function(){k.hideAsync()}),[!0]),u.a.useEffect((function(){if("android"==h.default.OS)return J.warmUpAsync(),function(){J.coolDownAsync()};"standalone"==O.default.appOwnership&&q.initAsync({}).catch((function(e){var t=e.message;F.default.alert("GoogleSignIn.initAsync(): "+t)}))}),[]);var m=M.useIdTokenAuthRequest({expoClientId:"896187396809-tn4obhk9l23t5u8uhmrspmn89iph7lr0.apps.googleusercontent.com",webClientId:"896187396809-5tbhq093deljombkbflt9c5mrfu7qvum.apps.googleusercontent.com",androidClientId:"896187396809-i55h6jach0jrja5studqj9dr2iiuhf8a.apps.googleusercontent.com",iosClientId:"896187396809-2ks3dj1dogegfsc8a9jr32s33tt4rben.apps.googleusercontent.com"}),y=c()(m,3),x=y[0],v=y[1],S=y[2];return u.a.useEffect((function(){if(console.log("response: "),console.log(v),"success"===(null==v?void 0:v.type)){var e=v.params.id_token;console.log(e);var t=V.default.auth.GoogleAuthProvider.credential(e);V.default.auth().signInWithCredential(t).catch((function(e){console.log(e),F.default.alert(e.message)}))}}),[v]),Object(N.jsx)(U.default,{behavior:"ios"==h.default.OS?"padding":"height",style:Y.container,children:Object(N.jsxs)(W.default,{style:{flex:1,justifyContent:"center",alignItems:"center",margin:20},children:[Object(N.jsx)(A.default,{style:Y.title,children:"Login"}),g&&Object(N.jsx)(A.default,{style:Y.errorMessage,children:g}),Object(N.jsx)(T.default,{style:Y.textInputBox,children:Object(N.jsx)(E.default,{placeholder:"Email",placeholderTextColor:"white",autoCapitalize:"none",style:Y.textInput,onChangeText:i,value:o})}),Object(N.jsx)(T.default,{style:Y.textInputBox,children:Object(N.jsx)(E.default,{secureTextEntry:!0,placeholder:"Password",placeholderTextColor:"white",autoCapitalize:"none",style:Y.textInput,onChangeText:f,value:d})}),Object(N.jsx)(z.default,{style:[Y.submitButton,{backgroundColor:"blue"}],onPress:function(){V.default.auth().signInWithEmailAndPassword(o,d).then((function(e){})).catch((function(e){e.message.includes("The user may have been deleted")&&(e.message=e.message.substring(0,e.message.indexOf("The user may have been deleted"))),F.default.alert(e.message),j(e.message)}))},children:Object(N.jsx)(A.default,{style:{color:"white",fontSize:20},children:"Sign In"})}),("ios"!=h.default.OS||"standalone"!=O.default.appOwnership||"The password is invalid or the user does not have a password."==g)&&Object(N.jsx)(G.SocialIcon,{title:"Sign In With Google",disabled:("standalone"!=O.default.appOwnership||"web"==h.default.OS)&&!x,button:!0,light:!0,style:Y.submitButton,type:"google",onPress:function(){var e,t,n,r,o;return a.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if("standalone"==O.default.appOwnership&&"web"!=h.default.OS){i.next=5;break}console.log("promting async"),S(),i.next=19;break;case 5:return i.prev=5,i.next=8,a.a.awrap(q.askForPlayServicesAsync());case 8:return i.next=10,a.a.awrap(q.signInAsync());case 10:e=i.sent,t=e.type,n=e.user,"success"===t&&(r=n.auth.idToken,console.log(r),o=V.default.auth.GoogleAuthProvider.credential(r),V.default.auth().signInWithCredential(o).catch((function(e){console.log(e),F.default.alert(e.message)}))),i.next=19;break;case 16:i.prev=16,i.t0=i.catch(5),i.t0.message;case 19:case"end":return i.stop()}}),null,null,[[5,16]],Promise)}}),Object(N.jsx)(G.Button,{titleStyle:{color:"white"},title:"Don't have an account? Sign Up",disabled:("standalone"!=O.default.appOwnership||"web"!=h.default.OS)&&!x,onPress:function(){return t.navigate("SignUp",{email:o})},type:"clear"})]})})}J.maybeCompleteAuthSession();var Y=L.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"red"},textInputBox:{borderBottomColor:"white",borderBottomWidth:1,marginBottom:40,alignSelf:"stretch"},textInput:{fontSize:24,height:40,fontWeight:"200",marginBottom:0,color:"white"},title:{fontSize:50,marginBottom:30,color:"white"},submitButton:{alignItems:"center",padding:15,borderRadius:7,marginBottom:10,margin:7,alignSelf:"stretch"},errorMessage:{color:"blue",marginBottom:20}});function H(e){var t=e.navigation,n=e.route,r=u.a.useState(n.params.email),o=c()(r,2),i=o[0],a=o[1],l=u.a.useState(null),s=c()(l,2),d=s[0],f=s[1],h=u.a.useState(null),p=c()(h,2),b=p[0],g=p[1];return Object(N.jsx)(U.default,{behavior:"padding",style:$.container,children:Object(N.jsxs)(W.default,{style:{flex:1,justifyContent:"center",alignItems:"center"},children:[Object(N.jsx)(A.default,{style:$.title,children:"Sign Up"}),b&&Object(N.jsx)(A.default,{style:{color:"blue",marginBottom:20},children:b}),Object(N.jsx)(T.default,{style:$.textInputBox,children:Object(N.jsx)(E.default,{placeholder:"Email",placeholderTextColor:"white",autoCapitalize:"none",style:$.textInput,onChangeText:a,value:i})}),Object(N.jsx)(T.default,{style:$.textInputBox,children:Object(N.jsx)(E.default,{secureTextEntry:!0,placeholder:"Password",placeholderTextColor:"white",autoCapitalize:"none",style:$.textInput,onChangeText:f,value:d})}),Object(N.jsx)(z.default,{style:$.submitButton,onPress:function(){V.default.auth().createUserWithEmailAndPassword(i,d).then((function(){})).catch((function(e){g(e.message),F.default.alert(e.message)}))},children:Object(N.jsx)(A.default,{style:{color:"white",fontSize:20},children:"Create Account"})}),Object(N.jsx)(G.Button,{titleStyle:{color:"white"},title:"Already have an account? Login",onPress:function(){return t.navigate("SignIn")},type:"clear"})]})})}var $=L.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"red"},textInputBox:{borderBottomColor:"white",borderBottomWidth:1,marginBottom:40,alignSelf:"stretch"},textInput:{alignSelf:"stretch",fontSize:24,height:40,fontWeight:"200",marginBottom:0,color:"white"},title:{fontSize:50,marginBottom:30,color:"white"},submitButton:{alignItems:"center",backgroundColor:"blue",alignSelf:"stretch",padding:15,borderRadius:7,marginBottom:10}}),_=n(26),Z=n.n(_),X=n(81),Q=n(88),ee=n(578),te=n(579),ne=n(587),re=n(580),oe=n(581),ie=n(146),ae=n.n(ie);function le(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ce(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var se=function(e){for(var t,n=0,r=le(e);!(t=r()).done;){n+=t.value.charCodeAt(0)}n%=126;var o="#"+(n/=126).toString(16).substring(2,8);return[o+"00",o+"30"]},ue=n(258),de=n(193);function fe(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return he(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var pe=v.createURL("/");function be(e){var t=e.navigation,n=u.a.useContext(j),r=(n.projectsData,n.listenToProject),o=n.stopListeningToProject,i=u.a.useState(!0),l=c()(i,2),d=l[0],f=l[1],p=u.a.useState([]),b=c()(p,2),g=b[0],x=b[1],v=u.a.useState(null),S=c()(v,2),w=S[0],P=S[1],I=u.a.useState(!1),C=c()(I,2),k=C[0],L=C[1],D=u.a.useState(""),R=c()(D,2),F=R[0],U=R[1],z=u.a.useState(""),W=c()(z,2),M=W[0],q=W[1],K=Object(s.useContext)(m),Y=Object(s.useContext)(y),H=Object(de.default)(),$=V.default.auth().currentUser.uid,_=V.default.firestore();function ie(){return a.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.awrap(oe.default("standard",[{identifier:"deleteNotif",buttonTitle:"Delete",options:{opensAppToForeground:!1,isAuthenticationRequired:!0,isDestructive:!0}}],{previewPlaceholder:"NotiBot Notification"}));case 2:return e.next=4,a.a.awrap(oe.default("webhookbutton",[{identifier:"webhookAction",buttonTitle:"Trigger Webhook Action",options:{opensAppToForeground:!0,isAuthenticationRequired:!0,isDestructive:!1}},{identifier:"deleteNotif",buttonTitle:"Delete",options:{opensAppToForeground:!0,isAuthenticationRequired:!0,isDestructive:!0}}],{previewPlaceholder:"NotiBot Notification With Webhook Action"}));case 4:return e.next=6,a.a.awrap(oe.default("webhooktext",[{identifier:"webhookReply",buttonTitle:"Send Text to Webhook",textInput:{submitButtonTitle:"SEND",placeholder:""},options:{opensAppToForeground:!0,isAuthenticationRequired:!0,isDestructive:!1}},{identifier:"deleteNotif",buttonTitle:"Delete",options:{opensAppToForeground:!0,isAuthenticationRequired:!0,isDestructive:!0}}],{previewPlaceholder:"NotiBot Notification With Webhook Reply"}));case 6:case"end":return e.stop()}}),null,null,null,Promise)}u.a.useEffect((function(){O.default.isDevice&&"web"!==h.default.OS&&function(){var e,t,n,r,o,i;return a.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return"android"===h.default.OS&&ee.default("default",{name:"default",importance:te.AndroidImportance.MAX,vibrationPattern:[0,250,250,250],lightColor:"#FF00007C"}),l.next=3,a.a.awrap(ne.getPermissionsAsync());case 3:if(e=l.sent,t=e.status,n=t,"granted"===t){l.next=12;break}return l.next=9,a.a.awrap(ne.requestPermissionsAsync());case 9:r=l.sent,o=r.status,n=o;case 12:if("granted"===n){l.next=15;break}return alert("Failed to get push token for push notification!"),l.abrupt("return");case 15:return l.next=17,a.a.awrap(re.default());case 17:i=l.sent.data,console.log(i),V.default.firestore().collection("Users").doc($).set({"Push Tokens":V.default.firestore.FieldValue.arrayUnion(i)},{merge:!0});case 20:case"end":return l.stop()}}),null,null,null,Promise)}().then(ie)}),[!0]),u.a.useLayoutEffect((function(){var e=null==K?void 0:K.substring(pe.length-1);e&&e.length>1&&"/"==e[0]||w!==g.length||Y.current.queue||0!=Y.current.projectsLoaded||(Y.current.projectsLoaded=!0,g.length>0&&(console.log("opening most recent project!"),t.navigate("Project",{title:g[0].title})),t.openDrawer()),Y.current.mainStackLoaded()}),[g,w]),u.a.useEffect((function(){var e=null==K?void 0:K.substring(pe.length-1);e&&e.length>1&&"/"==e[0]&&H(encodeURI(e))}),[!0]),u.a.useLayoutEffect((function(){var e=[],t=V.default.firestore().collection("Users").doc($).onSnapshot({includeMetadataChanges:!0},(function(t){if("Server"==(t.metadata.hasPendingWrites?"Local":"Server")){var n=t.data()&&t.data().Projects?t.data().Projects:[];console.log(t.data()),console.log("Current data: "+n);for(var o,i=function(t){if(!g.some((function(e){return e.title==t}))){var n=function(e){x((function(n){return n=n.filter((function(e){return e.title!=t})),e&&(n=[{title:t,subtitle:null!=e&&e.Notifications&&e.Notifications.length>0?e.Notifications[e.Notifications.length-1].title:"No notifications yet!",timestamp:null!=e&&e.Notifications&&e.Notifications.length>0?e.Notifications[e.Notifications.length-1].timestamp:0}].concat(Z()(n)),console.log("adding project to array: "+t)),n.sort((function(e,t){return(null==t?void 0:t.timestamp)-(null==e?void 0:e.timestamp)})),f(!1),console.log("new projects: "+JSON.stringify(n)),n}))};r(t,n,!0),e.push({projectName:t,subFunc:n})}},a=fe(n);!(o=a()).done;){i(o.value)}P(n.length),0==n.length&&f(!1)}}));return function(){for(var n=0,r=e;n<r.length;n++){var i=r[n],a=i.projectName,l=i.subFunc;o(a,l)}t()}}),[]);var le=function(){U(""),q(""),L(!k)};return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(G.Overlay,{isVisible:k,onBackdropPress:le,ModalComponent:"web"===h.default.OS?ae.a:Q.default,overlayStyle:["web"!=h.default.OS?{width:"80%",margin:"30%",maxWidth:400}:{},{backgroundColor:"red",borderRadius:10,bottom:"20%"}],children:Object(N.jsxs)(T.default,{children:[Object(N.jsx)(T.default,{style:ge.textInputBox,children:Object(N.jsx)(E.default,{placeholder:"Project Name",placeholderTextColor:"white",autoCapitalize:"none",style:ge.textInput,onChangeText:U,value:F})}),""!=M&&Object(N.jsx)(A.default,{style:ge.errorMessage,children:M}),Object(N.jsx)(G.Button,{title:"Create Project",onPress:function(){return a.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.awrap(a.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(F.toUpperCase().length<2)){e.next=3;break}return q("Your name must be at least 2 characters. You only have: "+F.length),e.abrupt("return",!1);case 3:if(F.toUpperCase().match("^[A-Z0-9]+$")){e.next=6;break}return q("Your name must only have letters and numbers (no spaces or special characters)"),e.abrupt("return",!1);case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),null,null,null,Promise));case 2:if(!e.sent){e.next=15;break}return e.prev=4,e.next=7,a.a.awrap(_.collection("Projects").doc(F.toUpperCase()).set({Owner:V.default.firestore.FieldValue.arrayUnion($)}));case 7:return e.next=9,a.a.awrap(_.collection("Users").doc($).set({Projects:V.default.firestore.FieldValue.arrayUnion(F.toUpperCase())},{merge:!0}));case 9:L(!1),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),"permission-denied"!=e.t0.code&&"already-exists"!=e.t0.code||q("Name already taken: "+F);case 15:case"end":return e.stop()}}),null,null,[[4,12]],Promise)}})]})}),Object(N.jsx)(G.Header,{backgroundColor:"red",leftComponent:{icon:"plus",type:"ant-design",color:"white",onPress:le,size:23},centerComponent:{text:"Projects",style:{color:"white",fontSize:18,fontWeight:"bold"}},rightComponent:{icon:"settings",type:"feather",color:"white",onPress:function(){return t.navigate("Settings")},size:23}}),Object(N.jsxs)(ue.LinearGradient,{colors:["#ff000090","red"],start:{x:0,y:.6},end:{x:0,y:0},style:ge.container,children:[d&&Object(N.jsx)(B.default,{size:"large"}),!d&&Object(N.jsx)(N.Fragment,{children:Object(N.jsx)(X.default,{style:{height:"100%",width:"100%"},data:g,renderItem:function(e){var n=e.item;return console.log("item: "+JSON.stringify(n)),Object(N.jsxs)(G.ListItem,{style:{borderRadius:20,marginVertical:5,backgroundColor:"white"},bottomDivider:!0,topDivider:!0,onPress:function(){t.navigate("Project",{title:n.title})},linearGradientProps:{colors:se(n.title),start:{x:1,y:0},end:{x:0,y:0}},ViewComponent:ue.LinearGradient,containerStyle:{borderRadius:20},children:[Object(N.jsx)(G.Avatar,{size:"large",rounded:!0,title:n.title.substring(0,2)}),Object(N.jsxs)(G.ListItem.Content,{children:[Object(N.jsx)(G.ListItem.Title,{style:ge.listItemTitle,adjustsFontSizeToFit:!0,numberOfLines:1,children:n.title}),Object(N.jsx)(G.ListItem.Subtitle,{style:ge.listItemSubtitle,children:n.subtitle})]}),Object(N.jsx)(G.ListItem.Chevron,{})]})},keyExtractor:function(e){return e.title},ListFooterComponent:Object(N.jsx)(G.Button,{title:"Open Docs",titleStyle:{textDecorationLine:"underline",color:"white"},onPress:function(){return J.openBrowserAsync("https://notibotdocs.kihtrak.com",{controlsColor:"#FF0000",showTitle:!0})},type:"clear"}),ListEmptyComponent:Object(N.jsxs)(T.default,{style:{flex:1,flexGrow:1,justifyContent:"center",alignItems:"center",padding:20},children:[Object(N.jsx)(A.default,{style:{color:"white"},children:"You currently have no projects"}),Object(N.jsx)(G.Button,{style:{marginTop:10},title:"Create a new project",onPress:le})]})})})]})]})}var ge=L.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",paddingTop:5,paddingHorizontal:5},textInputBox:{borderBottomColor:"white",borderBottomWidth:1,marginBottom:20,alignSelf:"stretch"},textInput:{fontSize:24,height:40,fontWeight:"200",marginBottom:0,color:"white",textAlign:"center"},errorMessage:{color:"blue",marginBottom:20},listItemTitle:{fontSize:"web"!=h.default.OS?30:20,fontWeight:"bold"},listItemSubtitle:{}});n(291);function je(e){e.navigation;var t=u.a.useState("No token"),n=c()(t,2),r=n[0],o=n[1],i=u.a.useState(!1),a=c()(i,2),l=a[0],s=a[1];function d(){V.default.auth().signOut().then().catch((function(e){return console.error("Sign Out Error",e)}))}return u.a.useEffect((function(){re.default().then((function(e){o(e.data)})).catch((function(e){return o(e.message)}))}),[]),Object(N.jsxs)(T.default,{style:me.container,children:[Object(N.jsx)(G.Button,{buttonStyle:me.dangerButton,title:"Sign Out",onPress:d,containerStyle:me.btnContainer}),Object(N.jsx)(G.Button,{buttonStyle:me.dangerButton,title:"Delete Account",onPress:function(){V.default.auth().currentUser.getIdToken(!0).then((function(e){return fetch("https://noti.kihtrak.com/deleteProfile",{body:JSON.stringify({idToken:e}),method:"POST",headers:{"Content-Type":"application/json"}})})).then((function(e){return e.json()})).then((function(e){var t=null==e?void 0:e.error;t&&F.default.alert(t),"success"==(null==e?void 0:e.status)&&d()})).catch((function(e){return F.default.alert("An error occurred while attempting delete your account")}))},containerStyle:me.btnContainer}),!l&&Object(N.jsx)(G.Button,{buttonStyle:me.infoButton,title:"Show Debug info",onPress:function(){return s(!0)},containerStyle:me.btnContainer}),l&&Object(N.jsxs)(A.default,{style:{marginTop:40},children:["You token for debugging is: ",r]})]})}var me=L.default.create({container:{flex:1,justifyContent:"center",alignItems:"center"},dangerButton:{backgroundColor:"red"},infoButton:{backgroundColor:"teal"},btnContainer:{marginTop:20,width:"90%",maxWidth:500}});function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}v.createURL("/");function ve(e){var t,n,r=e.navigation,o=e.route,i=Object(s.useContext)(j),a=i.projectsData,l=i.listenToProject,f=i.stopListeningToProject,h=null==(t=o.params)?void 0:t.title,p=Object(s.useState)(null==a||null==(n=a[h])?void 0:n.Notifications),b=c()(p,2),g=b[0],m=b[1],y=Object(d.default)().width>=768;u.a.useEffect((function(){if(h){var e=function(e){e?m(e.Notifications):r.openDrawer()};return l(h,e,!0),function(){return f(h,e)}}}),[h]),u.a.useLayoutEffect((function(){r.setOptions(xe(xe({},h?{title:h,headerRight:function(){return Object(N.jsx)(G.Button,{icon:{name:"ios-options-outline",type:"ionicon",size:25,color:"white"},type:"clear",onPress:function(){return r.navigate("ProjectOptions",{title:h})}})}}:{title:""}),{},{headerLeft:function(){return y?null:Object(N.jsx)(G.Button,{icon:{name:"menu",type:"entypo",size:25,color:"white"},type:"clear",onPress:function(){return r.openDrawer()}})}}))}),[r,h]);var x=function(e){return e.subtitle?e.subtitle:e.body?e.body:""};return h?Object(N.jsx)(T.default,{style:Oe.container,children:Object(N.jsx)(X.default,{style:{height:"100%",width:"100%"},data:g?Z()(g).reverse():[],renderItem:function(e){var t=e.item,n=e.index;return Object(N.jsxs)(G.ListItem,{style:Oe.listItem,bottomDivider:!0,topDivider:!0,onPress:function(){return r.navigate("Notification",{index:g.length-1-n,timestamp:t.timestamp,projTitle:h})},children:[Object(N.jsxs)(G.ListItem.Content,{children:[Object(N.jsx)(G.ListItem.Title,{children:t.title.substring(0,30)}),Object(N.jsx)(G.ListItem.Subtitle,{children:x(t).substring(0,40)}),Object(N.jsx)(G.ListItem.Subtitle,{left:!0,children:new Date(t.timestamp).toLocaleString()})]}),Object(N.jsx)(G.ListItem.Chevron,{})]})},keyExtractor:function(e){return e.title+e.timestamp},ListEmptyComponent:Object(N.jsxs)(T.default,{style:{flex:1,flexGrow:1,height:"100%",justifyContent:"center",alignItems:"center",padding:20},children:[Object(N.jsx)(A.default,{style:{fontSize:15,textAlign:"center",marginVertical:20},children:"The project currently has no notifications"}),Object(N.jsx)(G.Button,{title:"Learn how to send yourself a notification",titleStyle:{textDecorationLine:"underline"},onPress:function(){return J.openBrowserAsync("https://notibotdocs.kihtrak.com",{controlsColor:"#FF0000",showTitle:!0})},type:"clear"})]})})}):Object(N.jsx)(T.default,{style:Oe.container,children:Object(N.jsx)(A.default,{style:{fontSize:15,textAlign:"center"},children:"Select a project"})})}var Oe=L.default.create({container:{flex:1,justifyContent:"center",alignItems:"center"}}),Se=n(58),we=n(399),Pe=(n(558),["Owner","Manager","Subscriber"]);function Ie(e){var t,n,r=e.navigation,o=e.route,i=u.a.useContext(j),l=i.projectsData,s=i.listenToProject,d=i.stopListeningToProject,f=o.params,h=f.index,p=f.timestamp,b=f.projTitle,g=f.resValue,m=u.a.useState(null==l||null==(t=l[b])||null==(n=t.Notifications)?void 0:n[h]),y=c()(m,2),x=y[0],v=y[1],O=u.a.useState(""),S=c()(O,2),w=S[0],P=S[1],I=u.a.useState(g||""),C=c()(I,2),k=C[0],A=C[1],B=function(){for(var e=V.default.auth().currentUser.uid,t=0,n=[0,1];t<n.length;t++){var r,o,i=n[t];if(null!=l&&null!=(r=l[b])&&null!=(o=r[Pe[i]])&&o.includes(e))return!0}return!1},L=u.a.useState(B()),R=c()(L,2),F=R[0],U=R[1],M=V.default.firestore();u.a.useLayoutEffect((function(){var e=r.dangerouslyGetState();console.log("oldState"),console.log(JSON.stringify(e));var t=e.routes,n=e.index,o=null==t?void 0:t[t.length-2];"Project"==(null==o?void 0:o.name)&&(o.params||(o.params={title:b},console.log("oldState"),console.log(JSON.stringify(e)),r.reset({index:n,routes:t})))}),[r]),u.a.useEffect((function(){var e=function(e){if(e&&e.Notifications){for(var t=e.Notifications.length;t>-1&&(!e.Notifications[t]||e.Notifications[t].timestamp>p);)t--;e.Notifications[t]&&e.Notifications[t].timestamp==p?(U(B()),v(e.Notifications[t]),r.setParams({index:t})):r.goBack()}else r.goBack()};return s(b,e,!0),function(){return d(b,e)}}),[b,p]);var q=function(){return a.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.awrap(M.collection("Projects").doc(b).set({Notifications:V.default.firestore.FieldValue.arrayRemove(x)},{merge:!0}));case 2:case"end":return e.stop()}}),null,null,null,Promise)};u.a.useLayoutEffect((function(){r.setOptions({title:null==x?void 0:x.title,headerRight:function(){return F&&Object(N.jsx)(G.Button,{disabled:!F,icon:{name:"trash-outline",type:"ionicon",size:25,color:"white"},type:"clear",titleStyle:Ce.headerButtonTitle,onPress:q})}})}),[r,F,x]);return x?Object(N.jsx)(we.KeyboardAwareScrollView,{children:Object(N.jsx)(Se.default,{children:Object(N.jsxs)(W.default,{children:[Object(N.jsx)(T.default,{style:Ce.headerView,children:Object(N.jsx)(G.Text,{h1:!0,style:{textAlign:"center"},children:x.title})}),Object(N.jsx)(T.default,{style:{alignItems:"center"},children:Object(N.jsxs)(T.default,{style:Ce.subheaderView,children:[x.subtitle&&Object(N.jsx)(G.Text,{style:Ce.textMargin,h4:!0,left:!0,children:x.subtitle}),x.timestamp&&Object(N.jsx)(G.Text,{style:Ce.textMargin,right:!0,children:new Date(x.timestamp).toLocaleString()+"\nEpoch: "+x.timestamp})]})}),Object(N.jsxs)(T.default,{style:Ce.dataView,children:[Object(N.jsx)(G.Text,{style:[Ce.textMargin,{fontSize:25}],children:x.body}),x.webhook&&Object(N.jsxs)(G.Text,{style:Ce.textMargin,children:["Webhook: ",x.webhook]})]}),x.webhook&&Object(N.jsxs)(T.default,{style:{alignItems:"center"},children:[x.webhookParam&&Object(N.jsx)(T.default,{style:Ce.textInputBox,children:Object(N.jsx)(E.default,{placeholder:"URL parameter value",autoCapitalize:"none",style:Ce.textInput,onChangeText:P,value:w})}),Object(N.jsx)(z.default,{style:[Ce.submitButton,{backgroundColor:"green"}],onPress:function(){var e=x.webhook+w;fetch(e).then((function(e){return e.text()})).then(A).catch((function(e){return A(e.toString())}))},children:Object(N.jsxs)(G.Text,{style:{color:"white",fontSize:20},children:["Call ",x.webhook+w," ",k&&"Again"]})})]}),Object(N.jsx)(T.default,{style:Ce.dataView,children:!!k&&Object(N.jsxs)(G.Text,{style:Ce.textMargin,children:["Response: ",k]})})]})})}):Object(N.jsx)(D,{})}var Ce=L.default.create({container:{flex:1},headerView:{alignItems:"center",margin:10},subheaderView:{flex:1,flexDirection:"row",justifyContent:"space-between"},textMargin:{margin:10},headerButtonTitle:{color:"white"},dataView:{flex:1,flexDirection:"column",justifyContent:"flex-start"},textInputBox:{borderBottomColor:"black",borderBottomWidth:1,margin:10,marginBottom:40,alignSelf:"stretch"},textInput:{fontSize:24,height:40,fontWeight:"200",marginBottom:0,color:"black"},submitButton:{alignItems:"center",padding:15,borderRadius:7,marginBottom:10,margin:7,alignSelf:"stretch"}}),ke=n(197),Te=n(198),Ae=n(373),Be="web"===h.default.OS?function(e,t,n,r){if(window.confirm([e,t].filter(Boolean).join("\n"))){var o=n.find((function(e){return"cancel"!==e.style}));(null==o?void 0:o.onPress)&&(null==o||o.onPress())}else{console.log(n);var i=n.find((function(e){return"cancel"===e.style}));(null==i?void 0:i.onPress)&&(null==i||i.onPress())}}:F.default.alert;function Le(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ne(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var De=["Full Access","Can't delete project, edit team members, or toggle API key","Can only view data, can't delete notifications"];function Re(e){var t=e.navigation,n=e.route,r=u.a.useContext(j),i=r.projectsData,l=r.listenToProject,s=r.stopListeningToProject,d=n.params.title,f=u.a.useState([]),p=c()(f,2),b=p[0],g=p[1],m=u.a.useState(Pe.length),y=c()(m,2),x=y[0],v=y[1],O=u.a.useState(!1),S=c()(O,2),w=S[0],P=S[1],I=u.a.useState(!1),C=c()(I,2),k=C[0],L=C[1],D=u.a.useState(""),R=c()(D,2),F=R[0],U=R[1],W=u.a.useState(""),M=c()(W,2),q=M[0],J=M[1],K=u.a.useState(null),Y=c()(K,2),H=Y[0],$=Y[1],_=u.a.useState(!1),X=c()(_,2),ee=X[0],te=X[1],ne=u.a.useRef({}),re=V.default.firestore(),oe=(i[d],V.default.auth().currentUser.uid);u.a.useLayoutEffect((function(){var e=function(e){if(console.log("triggered"),e){$(e.APIKey);for(var n,r,o=[],i=function(t){if(console.log(t),e[t])for(var r,i=function(e){console.log(e),e==oe&&(n=Pe.indexOf(t)),ne.current[e]?o.push({group:t,profile:ne.current[e]}):fetch("https://noti.kihtrak.com/getProfileInfo",{body:JSON.stringify({uid:e}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(n){ne.current[e]=n,g((function(n){return[].concat(Z()(n),[{group:t,profile:ne.current[e]}])}))}))},a=Le(e[t]);!(r=a()).done;){i(r.value)}},a=Le(Pe);!(r=a()).done;){i(r.value)}v(n),o.length>0&&g(o),0!=n||e[Pe[0]].length>1?P(!0):P(!1)}else t.goBack()};return l(d,e,!0),function(){return s(d,e)}}),[]),u.a.useLayoutEffect((function(){t.setOptions({title:d+" Options"})}),[t]);var ie=function(){U(""),J(""),L(!k)},le=function(e){fetch("https://noti.kihtrak.com/getProfileByEmail",{body:JSON.stringify({email:e}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return console.log(e),V.default.auth().currentUser.getIdToken(!0).then((function(t){return fetch("https://noti.kihtrak.com/removeUserFromProject",{body:JSON.stringify({idToken:t,project:d,uid:e.uid}),method:"POST",headers:{"Content-Type":"application/json"}})}))})).catch((function(t){return Be("An error occurred while attempting to remove "+e+" from the project")}))};return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(G.Overlay,{isVisible:k,onBackdropPress:ie,ModalComponent:"web"===h.default.OS?ae.a:Q.default,overlayStyle:["web"!=h.default.OS?{width:"80%",margin:"30%",maxWidth:400}:{},{backgroundColor:"red",borderRadius:10,bottom:"20%"}],children:Object(N.jsxs)(T.default,{children:[Object(N.jsx)(T.default,{style:Ee.textInputBox,children:Object(N.jsx)(E.default,{placeholder:"Email",placeholderTextColor:"white",autoCapitalize:"none",style:Ee.textInput,onChangeText:U,value:F})}),""!=q&&Object(N.jsx)(A.default,{style:Ee.errorMessage,children:q}),Object(N.jsx)(G.Button,{title:"Add User",onPress:function(){fetch("https://noti.kihtrak.com/getProfileByEmail",{body:JSON.stringify({email:F}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return console.log(e),V.default.auth().currentUser.getIdToken(!0).then((function(t){return fetch("https://noti.kihtrak.com/addUserToProject",{body:JSON.stringify({idToken:t,project:d,uid:e.uid}),method:"POST",headers:{"Content-Type":"application/json"}})}))})).then((function(){return L(!1)})).catch((function(e){return Be("An error occurred while attempting to add "+F+" to the project")}))}})]})}),Object(N.jsxs)(Se.default,{contentContainerStyle:Ee.container,children:[Object(N.jsx)(T.default,{style:{width:"100%"},children:function(){var e=[],t=function(t){var n=b[t],r=void 0;e.push(Object(N.jsxs)(G.ListItem,{style:[Ee.listItem,{zIndex:-1*t}],bottomDivider:!0,topDivider:!0,children:[Object(N.jsx)(G.Avatar,{source:{uri:n.profile.photoURL},title:n.profile.email.substring(0,2),rounded:!0}),Object(N.jsxs)(G.ListItem.Content,{children:[Object(N.jsx)(G.ListItem.Title,{children:n.profile.displayName}),Object(N.jsx)(G.ListItem.Subtitle,{adjustsFontSizeToFit:!0,numberOfLines:1,children:n.profile.email})]}),Object(N.jsx)(Ae.default,{disabled:x>0||oe==n.profile.uid&&!w,items:[].concat(Z()(Pe),["Remove"]).map((function(e){return{label:e,value:e}})),defaultValue:n.group,containerStyle:{flexGrow:.5},itemStyle:{overflow:"visible"},controller:function(e){return r=e},onChangeItem:function(e){var t=e.value;if(console.log(t),"Remove"==t)Be("Remove "+n.profile.email,"Are you sure you want remove "+n.profile.email+" from this project?",[{text:"Remove",onPress:function(){return a.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:le(n.profile.email);case 1:case"end":return e.stop()}}),null,null,null,Promise)},style:"destructive"},{text:"Cancel",style:"cancel",onPress:function(){r.selectItem(n.group)}}],{cancelable:!0,onDismiss:function(){r.selectItem(n.group)}});else{var o={};Pe.forEach((function(e){o[e]=V.default.firestore.FieldValue.arrayRemove(n.profile.uid)})),o[t]=V.default.firestore.FieldValue.arrayUnion(n.profile.uid),re.collection("Projects").doc(d).update(o)}}})]},n.profile.email))};for(var n in b)t(n);return 0==e.length?Object(N.jsx)(B.default,{size:"large",style:{padding:10}}):e}()}),Object(N.jsxs)(G.ListItem,{style:[{zIndex:-9},Ee.listItem],bottomDivider:!0,topDivider:!0,disabled:x>0,onPress:ie,children:[Object(N.jsx)(G.Icon,{name:"plus",type:"ant-design",color:"blue"}),Object(N.jsx)(G.ListItem.Content,{children:Object(N.jsx)(G.ListItem.Title,{children:"Add User"})})]}),function(){var e=[];for(var t in Pe)e.push(Object(N.jsxs)(T.default,{style:[Ee.listItem,Ee.descContainer],children:[Object(N.jsx)(A.default,{style:[t==x?{color:"blue"}:{},Ee.groupTitle,Ee.groupText],children:Pe[t]}),Object(N.jsx)(A.default,{style:[Ee.groupDesc,Ee.groupText],children:De[t]})]},t));return e}(),H&&Object(N.jsx)(z.default,{onPress:function(){ee?"web"===h.default.OS?ke.default.setString(H):Te.default.share({message:H}):te(!0)},style:Ee.codeContainer,children:Object(N.jsx)(A.default,{style:Ee.code,children:ee?H:"Click to show API key"})}),(!H||ee)&&Object(N.jsx)(G.Button,{disabled:x>0,containerStyle:Ee.btnContainer,title:H?"Disable API Key":"Enable API Key",buttonStyle:H?Ee.leaveButton:Ee.keyButton,onPress:function(){H?Be("Delete API Key","Are you sure you want to delete the API Key for "+d+"?",[{text:"Delete",onPress:function(){re.collection("Projects").doc(d).update({APIKey:V.default.firestore.FieldValue.delete()})},style:"destructive"},{text:"Cancel",style:"cancel"}],{cancelable:!0}):Be("Enable API Key","Any future request will require this key.",[{text:"Enable",onPress:function(){V.default.auth().currentUser.getIdToken(!0).then((function(e){return fetch("https://noti.kihtrak.com/addAPIKey",{body:JSON.stringify({idToken:e,project:d}),method:"POST",headers:{"Content-Type":"application/json"}})})).catch((function(e){return Be("An error occurred while attempting to enable the API Key")}))},style:"destructive"},{text:"Cancel",style:"cancel"}],{cancelable:!0})}}),Object(N.jsx)(G.Button,{disabled:x>1,containerStyle:Ee.btnContainer,title:"Delete Notifications",buttonStyle:Ee.deleteButton,onPress:function(){Be("Delete "+d,"Are you sure you want to delete all of "+d+"'s notifications?",[{text:"Delete",onPress:function(){return a.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.awrap(re.collection("Projects").doc(d).update({Notifications:V.default.firestore.FieldValue.delete()}).then((function(){return t.goBack()})).catch((function(e){return Be("An error occurred while attempting to delete the notifications")})));case 2:case"end":return e.stop()}}),null,null,null,Promise)},style:"destructive"},{text:"Cancel",style:"cancel"}],{cancelable:!0})}}),Object(N.jsx)(G.Button,{disabled:!w,containerStyle:Ee.btnContainer,title:"Leave Project",buttonStyle:Ee.leaveButton,onPress:function(){return a.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.awrap(re.collection("Projects").doc(d).update(o()({},Pe[x],V.default.firestore.FieldValue.arrayRemove(oe))));case 2:return e.next=4,a.a.awrap(re.collection("Users").doc(oe).update({Projects:V.default.firestore.FieldValue.arrayRemove(d)}));case 4:case"end":return e.stop()}}),null,null,null,Promise)}}),!w&&Object(N.jsx)(A.default,{style:Ee.explanationText,children:"You are the only owner, you can't leave without appointing a new owner"}),Object(N.jsx)(G.Button,{disabled:x>0,containerStyle:Ee.btnContainer,title:"Delete Project",buttonStyle:Ee.deleteButton,onPress:function(){Be("Delete "+d,"Are you sure you want to delete "+d+"?",[{text:"Delete",onPress:function(){return a.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:V.default.auth().currentUser.getIdToken(!0).then((function(e){return fetch("https://noti.kihtrak.com/deleteProject",{body:JSON.stringify({idToken:e,project:d}),method:"POST",headers:{"Content-Type":"application/json"}})})).catch((function(e){return Be("An error occurred while attempting to delete the project")}));case 1:case"end":return e.stop()}}),null,null,null,Promise)},style:"destructive"},{text:"Cancel",style:"cancel"}],{cancelable:!0})}})]})]})}var Ee=L.default.create({container:{paddingBottom:20,alignItems:"center"},deleteButton:{backgroundColor:"red"},leaveButton:{backgroundColor:"blue"},keyButton:{backgroundColor:"teal"},btnContainer:{marginTop:20,width:"90%",maxWidth:600},listItem:{width:"100%"},descContainer:{flexGrow:1,flexDirection:"row",padding:10,zIndex:-99},groupTitle:{marginRight:10,flexBasis:100},groupText:{fontSize:15},groupDesc:{flexShrink:1,flexWrap:"wrap"},explanationText:{textAlign:"center",marginHorizontal:20},textInputBox:{borderBottomColor:"white",borderBottomWidth:1,marginBottom:20,alignSelf:"stretch"},textInput:{fontSize:24,height:40,fontWeight:"200",marginBottom:0,color:"white",textAlign:"center"},codeContainer:{backgroundColor:"#1E1E1E",padding:16,borderRadius:8,margin:16,marginBottom:6,maxWidth:"90%"},code:{color:"#FFFFFF",fontFamily:"Courier New",fontSize:14,lineHeight:20}}),Fe=n(585);function Ue(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ze(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}try{V.default.initializeApp({apiKey:"AIzaSyBc_AtukKnVqdNYRefB-NtZLy5otD8KMvA",authDomain:"notibotapp.firebaseapp.com",databaseURL:"https://notibotapp.firebaseio.com",projectId:"notibotapp",storageBucket:"notibotapp.appspot.com"})}catch(Ye){}var Me=Object(b.default)(),qe=Object(g.default)(),Ge=V.default.firestore(),Je=v.createURL("/");function Ke(){var e=u.a.useRef({}),t=(u.a.useRef({}),u.a.useRef({})),n=u.a.useRef({}),r=Object(s.useRef)(),o=Object(s.useRef)(),i=Object(s.useRef)({mainStackLoaded:function(){setTimeout((function(){return k.hideAsync().catch()}),500),i.current.loaded=!0,i.current.queue&&i.current.queue()},loaded:!1,projectsLoaded:!1,queue:null}),l=u.a.useState(null),b=c()(l,2),g=b[0],S=b[1],w=("web"===h.default.OS?f.default.get("window").width:Object(d.default)().width)>=768,P=C(),I=function(e){i.current.loaded?P.linkTo(e):i.current.queue=function(){return P.linkTo(e)}};u.a.useLayoutEffect((function(){if(O.default.isDevice&&"web"!==h.default.OS)return r.current=Fe.addNotificationReceivedListener((function(e){var t=e.request.content;Object(x.showMessage)({message:t.title,description:t.body,type:"info",hideStatusBar:!0,onPress:function(){var e,n,r;P.linkTo("/Main/Projects/Notification?projTitle="+(null==(e=t.data)?void 0:e.project)+"&timestamp="+(null==(n=t.data)||null==(r=n.firebaseData)?void 0:r.timestamp))}})})),o.current=Fe.addNotificationResponseReceivedListener((function(e){var t,n,r,o,i,l;return a.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=e.notification.request.content.data,"deleteNotif"!=e.actionIdentifier){a.next=3;break}return a.abrupt("return",Ge.collection("Projects").doc(null==t?void 0:t.project).set({Notifications:V.default.firestore.FieldValue.arrayRemove(null==t?void 0:t.firebaseData)},{merge:!0}));case 3:if(n="","webhookAction"!=e.actionIdentifier){a.next=8;break}n=null==t||null==(r=t.firebaseData)?void 0:r.webhook,a.next=13;break;case 8:if("webhookReply"!=e.actionIdentifier){a.next=12;break}n=(null==t||null==(o=t.firebaseData)?void 0:o.webhook)+(null==e?void 0:e.userText),a.next=13;break;case 12:return a.abrupt("return",I(encodeURI("Main/Projects/Notification?projTitle="+(null==t?void 0:t.project)+"&timestamp="+(null==t||null==(i=t.firebaseData)?void 0:i.timestamp))));case 13:l=function(e,n){var r;Object(x.showMessage)({message:n?"Webhook call failed!":"Webhook called!",type:n?"danger":"success",hideStatusBar:!0}),I(encodeURI("Main/Projects/Notification?projTitle="+(null==t?void 0:t.project)+"&timestamp="+(null==t||null==(r=t.firebaseData)?void 0:r.timestamp)+"&resValue="+e))},fetch(n).then((function(e){return e.text()})).then(l).catch((function(e){return l(e.toString(),!0)}));case 15:case"end":return a.stop()}}),null,null,null,Promise)})),function(){Fe.removeNotificationSubscription(r.current),Fe.removeNotificationSubscription(o.current)}}),[!0]);var T=u.a.useReducer((function(e,t){switch(t.type){case"SIGN_IN":return Ve(Ve({},e),{},{isLoading:!1,isSignedIn:t.isSignedIn});case"SIGN_OUT":return Ve(Ve({},e),{},{isLoading:!1,isSignedIn:!1})}}),{isLoading:!0,isSignedIn:!1}),A=c()(T,2),B=A[0],L=A[1];u.a.useLayoutEffect((function(){v.getInitialURL().then((function(e){S(e)}))}),[!0]),u.a.useLayoutEffect((function(){try{V.default.auth().onAuthStateChanged((function(e){console.log("Auth: "+!!e),L({type:"SIGN_IN",isSignedIn:!!e}),e&&setTimeout((function(){return k.hideAsync().catch()}),3e3)}))}catch(e){k.hideAsync().catch()}}),[]),u.a.useLayoutEffect((function(){k.preventAutoHideAsync()}),[!0]);var R={projectsData:e.current,listenToProject:function(r,o,i){t.current[r]?(console.log("listener already exists for "+r),t.current[r].push(o),i&&r in e.current&&o(e.current[r])):(console.log("creating listener for "+r),t.current[r]=[o],n.current[r]=Ge.collection("Projects").doc(r).onSnapshot({includeMetadataChanges:!0},(function(n){if("Server"==(n.metadata.hasPendingWrites?"Local":"Server")){e.current[r]=n.data();for(var o,i=Ue(t.current[r]);!(o=i()).done;){(0,o.value)(n.data())}}}),(function(n){e.current[r]=null;for(var o,i=Ue(t.current[r]);!(o=i()).done;){(0,o.value)(null)}})))},stopListeningToProject:function(e,r){t.current[e]||console.warn("Listener doesn't exist. How did this happen?");var o=t.current[e].indexOf(r);console.log("Index of callback in array: "+o),t.current[e].splice(o,1),0==t.current[e].length&&(t.current[e]=null,n.current[e]())}},E=function(){return Object(N.jsxs)(Me.Navigator,{screenOptions:{headerStyle:{backgroundColor:"red"},headerTintColor:"#fff",headerTitleStyle:{fontWeight:"bold"}},children:[Object(N.jsx)(Me.Screen,{name:"Project",component:ve}),Object(N.jsx)(Me.Screen,{name:"ProjectOptions",component:Re}),Object(N.jsx)(Me.Screen,{name:"Notification",component:Ie})]})};return Object(N.jsxs)(p.default,{ref:P.navigationRef,linking:{prefixes:[Je,"http://localhost:19006","https://notibot.kihtrak.com"],screens:{ProjectsDrawerScreen:{path:"",screens:{Projects:{path:"",screens:{Project:"project/:title",Notification:"notification/:projTitle/:timestamp/:resValue?/:index?"}}}}},subscribe:function(e){var t=function(t){var n=t.url;e(n),console.log("setInitialDeepLink("+n+")"),n!=g&&S(n)};return v.addEventListener("url",t),function(){v.removeEventListener("url",t)}}},children:[Object(N.jsx)(y.Provider,{value:i,children:Object(N.jsx)(m.Provider,{value:g,children:Object(N.jsx)(j.Provider,{value:R,children:Object(N.jsx)(Me.Navigator,{screenOptions:{headerStyle:{backgroundColor:"red"},headerTintColor:"#fff",headerTitleStyle:{fontWeight:"bold"}},children:B.isLoading?Object(N.jsx)(Me.Screen,{name:"Splash",component:D,options:{headerShown:!1}}):0==B.isSignedIn?Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(Me.Screen,{name:"SignIn",component:K,options:{headerShown:!1,animationTypeForReplace:B.isSignedIn?"push":"pop"}}),Object(N.jsx)(Me.Screen,{name:"SignUp",component:H,options:{headerShown:!1,animationTypeForReplace:B.isSignedIn?"push":"pop"}})]}):Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(Me.Screen,{name:"Main",component:function(){return Object(N.jsx)(qe.Navigator,{drawerType:w?"permanent":"back",drawerStyle:w?null:{width:"100%"},overlayColor:"transparent",drawerContent:function(e){return Object(N.jsx)(be,Ve({},e))},screenOptions:{gestureEnabled:!0},children:Object(N.jsx)(qe.Screen,{name:"Projects",component:E})})},options:{headerShown:!1}}),Object(N.jsx)(Me.Screen,{name:"Settings",component:je})]})})})})}),Object(N.jsx)(x.default,{position:"top"})]})}},403:function(e,t,n){e.exports=n(559)},439:function(e,t){}},[[403,1,2]]]);
//# sourceMappingURL=app.a5ebb4f6.chunk.js.map